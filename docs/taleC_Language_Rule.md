# taleC 文档

## core

面向AVG制作者优化

AVG是文字冒险类游戏的缩写，是玩家主要与屏幕上出现的文字、图像等不同事件进行交互的游戏。

## 简介

taleC 是一门用于编写文字交互程序的简易编程语言。

用C语言开发。taleC 具有内建支持生成控制台文字交互程序，也可以通过C语言外接其他软件来实现前端功能。

## 语法规范

### 变量

taleC 和C语言在变量方面完全一致

```c
int i = 0;
char* p = NULL;
```

### 内建函数

#### 字符串输出语句

在文字交互程序中会有大量的文本操作，而每次输入 printf 都是灾难的体验。因此我们简化了输出函数：

```
"hello"//输出字符串，行末自动换行。
//没错，就是敲一行字符串，然后回车，不需要分号

"hello"\
//在字符串结尾紧跟一个反斜杠字符，可以输出一个行末不换行的字符串。


"" @x ""//这是用以撰写剧本式交互的语法.
//当然，前面代表人名的字符串可用如下方式替换
tag @x ""
//tag是一个字符串变量名，可以是用户自定义的变量（人物名），x是确定用户想以何种形式分割。
//注意 @x首尾的空格不是必要的，可忽略也可增长。

x内建地具有如下两种情况
/*
input   example
x = :  	haru: ohaiyo~
x = >  	haru> ohaiyo~
	
另外，可以采用 tag @(sep) ""的方式，自定义想要使用的分隔符。例如：
code						output
haru @(-> ) "ohha!" 	haru-> ohha\n
*/
//注意（）方法是所见即所得的，也就是说尾部的空格不输入，上方的箭头就会与ohha没有分隔了。
//遗憾的是，括号中不能出现小括号，双引号和@
```

#### 互动语句

AVG中玩家一般要按键触发下一个场景，这个复杂的操作被我们简化为一个单独占一行的$符号。

```
"hello!"
$
"nice to meet you!"
```

玩家按下任意键然后回车，就会进入下一条语句，否则暂停（按两下回车也行）

#### 场景结构

在文字交互类应用中，核心是场景切换，因此，我们有全新设计的场景系统

```c
Scene(scene_name){
    //scene_name 无需用双引号包裹！
    //scene代码块{}包裹的内容是本地的，超出代码块范围后会失效。
//Scene函数有一个默认的本地变量 scene_tag　他会从０开始标记你当前创建的场景，只能在Scene内部访问。
	temp = 2//111内部可以定义局部变量
	"  "
	//可以用goto [scene_name]; 跳转到任何一个场景的开始，
    //用goto [scene_name]_end;跳转到任何一个场景的末尾;
}
//例如 
Scene(hello){
    "hello!"
}
goto hello;//跳转到hello
goto hello_end;//跳转到hello末尾
```



### C语言支持

#### 语言支持

taleC支持在内部任何地方写Ｃ语言表达式，函数。但暂时不支持如同ｃ语言一般定义函数

我们建议将函数功能写在场景之间，这样他们能在所有场景间通信！

一个暂时的定义函数的方法是将代码块写在第一个场景之前，并用goto包裹（虽然这很蠢！）

或者将代码块写在最终场景之后并且用goto调用它（这也很蠢！）

我们以后或许会加入call label语法，支持调用某个场景后回到当前位置。

（我们以后也会支持函数定义的！)

**关于注释：目前我们只支持单独成行以//开头的注释。**	

#### c库支持

内建有stdio，stdlib，string，time，math5个库，如果需要其他库，请在编译器源码中加入并重新编译一份编译器（或者使用我们的一键生成bat！）

## 存档和读档

既然是AVG（或者不如说既然是游戏）就要有存档读档功能啦！

遗憾的是，我们目前只支持存一个档。

我们曾经考虑过可存很多档，或者说随时存档，但是这会十分消耗文本文档的空间（以及损耗您的磁盘），查询存档也很费力。

存档会被保存在游戏根目录下的__load.txt文件中，格式为（场景，时间），需要多个档自己复制一下文件吧。

（当然以后我们会努力做出多存档功能的！）

### 存档退出

在任何一个$语法处，玩家输入Q回车，系统就会询问您是否要存档并退出，输入y回车确定，n取消

### 存档

在任何一个$语法处，玩家输入S回车，系统就会询问您是否要存档，输入y回车确定，n取消

### 读档

游戏开始时，会询问玩家是否要读档，输入y确定后，游戏提示您上一次存档的时间，读档后跳转到上一次游玩的场景的开头



## 帮我们变得更好！

本作品是南京大学2020级的C语言课程作业。草草完工的代码里确实残留着一些不规范的地方。并且诸多地方可以改进。

作者承认本作品由游戏制作引擎 renpy 启发，并希望能向 renpy 靠拢，成为一个全面的AVG制作引擎。

如果您对使用类python语法进行更精致深入的AVG制作，您也可以浏览 [The Ren'Py Visual Novel Engine (renpy.org)](https://www.renpy.org/)

如有任何建议，希望您联系以下邮箱 johnsonzht@126.com

